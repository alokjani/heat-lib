heat_template_version: 2015-10-15

description: >
  Template for creating a MySQL database

parameters:

  name:
    type: string
    description: Database name

  username:
    type: string
    description: Username who will be managing this DB

  password:
    type: string
    description: Password for user if username is new. If user exists, only permissions will be granted regardless of the value for password
    default: "autogenerated"

  instance:
    type: string
    description: The instance where this Software Configuration should be applied
    constraints:
      - custom_constraint: nova.server

resources:

  config:
    type: OS::Heat::SoftwareConfig
    properties:
      group: script
      inputs:
        - name: name
        - name: username
        - name: password
      outputs:
        - name: status
        - name: password
      config: { get_file: scripts/mysql_database/configure.sh }

  config_deployment:
    type: OS::Heat::SoftwareDeployment
    properties:
      config: { get_resource: config }
      server: { get_param: instance }
      signal_transport: HEAT_SIGNAL
      input_values:
        name: { get_param: name }
        username: { get_param: username }
        password: { get_param: password }
      actions:
        - CREATE

outputs:
  config_status:
    value: { get_attr: [config_deployment, status] }

  config_stderr:
    value: { get_attr: [config_deployment, deploy_stderr] }
